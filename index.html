<div class="text">Text01111</div>

<span class="toggle"></span>

<script type="text/javascript">
	document.querySelector(".toggle").addEventListener("click", function (event) {
  this.classList.add("animate");

  setTimeout(() => {
    this.classList.toggle("active");
    toggleTheme(event);
  }, 150);

  setTimeout(() => this.classList.remove("animate"), 300);
});
/**
 * åˆ‡æ¢ä¸»é¢˜è‰²ï¼Œæ‰©æ•£æ¸å˜åŠ¨ç”»
 *
 * @param {MouseEvent} event ç‚¹å‡»äº‹ä»¶
 */
function toggleTheme(event) {
  const willDark = !isDark();
  // æµè§ˆå™¨æ–°ç‰¹æ€§ä¸æ”¯æŒ æˆ–è€… å¼€å¯äº†åŠ¨ç”»å‡å¼±
  if (!document.startViewTransition || isReducedMotion()) {
    toggleDark();
    return;
  }

  const transition = document.startViewTransition(() => {
    toggleDark();
  });

  // ä¼ å…¥ç‚¹å‡»äº‹ä»¶ï¼Œä»ç‚¹å‡»å¤„å¼€å§‹æ‰©æ•£ã€‚å¦åˆ™ï¼Œä»å³ä¸Šè§’å¼€å§‹æ‰©æ•£
  const x = event?.clientX ?? window.innerWidth;
  const y = event?.clientY ?? 0;

  const endRadius = Math.hypot(
    Math.max(x, innerWidth - x),
    Math.max(y, innerHeight - y)
  );
  void transition.ready.then(() => {
    const clipPath = [
      `circle(0px at ${x}px ${y}px)`,
      `circle(${endRadius}px at ${x}px ${y}px)`
    ];
    document.documentElement.animate(
      {
        clipPath: willDark ? clipPath : [...clipPath].reverse()
      },
      {
        duration: 500,
        easing: "ease-in",
        pseudoElement: willDark
          ? "::view-transition-new(root)"
          : "::view-transition-old(root)"
      }
    );
  });
}
/**
 * åˆ‡æ¢ä¸»é¢˜è‰²ï¼Œhtmlæ ‡ç­¾åˆ‡æ¢darkç±»
 */
function toggleDark() {
  document.documentElement.classList.toggle("dark");
}

/**
 * æ£€æµ‹ç”¨æˆ·çš„ç³»ç»Ÿæ˜¯å¦è¢«å¼€å¯äº†åŠ¨ç”»å‡å¼±åŠŸèƒ½
 * @link https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-reduced-motion
 */
function isReducedMotion() {
  return window.matchMedia(`(prefers-reduced-motion: reduce)`).matches === true;
}

/**
 * å½“å‰ä¸»é¢˜è‰²æ˜¯å¦æ˜¯æš—è‰²
 */
function isDark() {
  return document.documentElement.classList.contains("dark");
}

</script>

<style>
	:root {
  --black: #333333;
  --white: #f5f5f5;
  --background: var(--white);
  --foreground: var(--black);
}
:root.dark {
  --background: var(--black);
  --foreground: var(--white);
}
html {
  background: var(--background);
  color: var(--foreground);
}
html,
body {
  height: 100%;
}
.toggle {
  position: absolute;
  cursor: pointer;
  top: 20px;
  right: 25px;
  font-size: 150%;
}

.toggle:before {
  content: "â˜€ï¸";
}

.toggle.active:before {
  content: "ğŸŒ’";
}
.toggle.animate {
  animation: animate 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes animate {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(0);
  }
  100% {
    transform: scale(1);
  }
}

.text {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

/**
 Animated Theme Toggle
 */
::view-transition-old(root),
::view-transition-new(root) {
  animation: none;
  mix-blend-mode: normal;
}

.dark::view-transition-old(root) {
  z-index: 1;
}
.dark::view-transition-new(root) {
  z-index: 999;
}

::view-transition-old(root) {
  z-index: 999;
}
::view-transition-new(root) {
  z-index: 1;
}

</style>
